# Stock Tracker - 项目TODO

## 第一阶段：搜索功能优化
- [x] 修复搜索栏同步显示功能（代码、名称、拼音搜索）
- [x] 优化搜索结果UI展示
- [x] 支持快速进入股票详情页面

## 第二阶段：市场观点实时生成
- [x] 设计市场观点生成算法（基于热点板块、行业新闻、政策利好、近期行情、资金流向）
- [x] 实现市场观点后端 API（tRPC）
- [x] 集成LLM生成专业分析文本
- [ ] 添加具体买卖建议和目标价
- [ ] 实现推荐收益率实时变化追踪
- [ ] 更新首页市场核心观点展示

## 第三阶段：问票AI对话功能
- [x] 设计“问票”功能架构和数据库schema
- [x] 创建问票页面UI
- [x] 实现AI对话系统（tRPC后端）
- [x] 集成多大模型支持（OpenAI、Claude等）
- [ ] 实现实时股票数据访问和分析
- [ ] 支持对比分析功能
- [x] 实现对话历史存储
- [x] 实现对话导出和报告生成功能
- [x] 添加用户认证和权限控制
- [ ] 设计AI智能体角色和工作流

## 第四阶段：测试和优化
- [x] 编写搜索功能单元测试
- [x] 编写市场观点生成测试
- [x] 编写AI对话功能测试
- [ ] 性能优化和缓存策略
- [x] 用户体验优化

## 已完成功能
- [x] 升级到web-db-user方案
- [x] 修复Home.tsx导入
- [x] 项目编译成功


## 第五阶段：多媒体文件支持
- [x] 设计文件处理架构和数据库扩展
- [x] 实现后端文件上传API（S3集成）
- [x] 实现文件内容提取和分析
- [x] 实现前端文件上传UI和预览功能
- [x] 集成Vision API进行图片分析
- [x] 实现文件预览功能
- [x] 编写文件处理单元测试
- [x] 优化文件上传性能和错误处理


## 第六阶段：问票UI优化
- [x] 重设计文件上传UI - 改为输入框旁的小图标
- [x] 实现隐式文件上传 - 支持直接拖拽和粤贴
- [x] 分离文件和输入内容显示
- [x] 优化问票页面整体布局
- [x] 测试UI交互和用户体验


## 第七阶段：问票输入框Manus风格改造
- [x] 改造输入框为Manus风格布局
- [x] 左边添加“+”和文件上传按针
- [x] 右边添加语音和发送按针
- [x] 优化输入框视觉效果
- [x] 测试UI交互


## 第八阶段：消息交互功能增强
- [x] 创建消息操作按针组件（MessageActions.tsx）
- [x] 实现AI回复的语音播报功能
- [x] 实现AI回复的复制功能
- [x] 实现AI回复的重新生成功能
- [x] 实现AI回复的分享功能
- [x] 实现用户提问的复制功能
- [x] 实现用户提问的分享功能
- [x] 实现用户提问的编辑功能
- [x] 实现用户提问的删除功能
- [x] 集成到AskStock页面
- [x] 编写交互功能单元测试
- [x] 测试所有功能


## 第九阶段：语音播报功能优化
- [x] 创建语音播报工具函数（speechUtils.ts）
- [x] 实现文本清理功能（移除Markdown标记）
- [x] 实现股票代码识别和转换
- [x] 创建语音设置面板（VoiceSettings.tsx）
- [x] 支持多种人声选择
- [x] 支持播报速度调整
- [x] 集成到MessageActions组件
- [x] 测试语音播报功能


## 第十阶段：市场概览卡片背景优化
- [x] 优化MarketIndexCard的背景色设计
- [x] 消除生硬的色块差异
- [x] 实现平滑的渐变过渡


## 第十一阶段：问票对话框消息样式优化
- [x] 优化对话消息显示风格
- [x] 参考Manus对话设计
- [x] 消除用户消息和AI回复的色块差异


## 第十二阶段：智能涨停潜力股追踪系统（进行中）
- [x] 设计涨停潜力股分析引擎架构
- [x] 实现当日涨停潜力股分析（盘中5分钟更新）
  - [x] 数据库schema设计（dailyLimitUpPotentials表）
  - [x] 后端API实现（getDailyPotentials、saveDailyAnalysis）
  - [x] 前端页面实现（DailyLimitUp.tsx）
  - [x] 多维度排序和统计功能
  - [x] 单元测试（11个测试全部通过）
- [x] 实现次日涨停潜力股分析（收盘后更新）
  - [x] 数据库schema设计（nextDayLimitUpPotentials表）
  - [x] 后端API实现（getNextDayPotentials、saveNextDayAnalysis）
  - [x] 前端页面实现（NextDayLimitUp.tsx）
  - [x] 基本面和情绪评分展示
  - [x] 单元测试（11个测试全部通过）
- [x] 设计多因素综合评分模型（成交量、资金流、涨速、情绪、热点等）
- [x] 路由配置和菜单集成
- [ ] 实现定时任务系统（5分钟和收盘后）
- [ ] 实现真实数据接入和分析
- [ ] 优化首页涨停潜力股板块显示
- [ ] 测试和优化整体系统


## 第十三阶段：完善数据分析引擎和定时更新系统（进行中）
- [x] 完善数据分析引擎 - 集成真实新浪财经数据
  - [x] 创建数据分析服务（analysisService.ts）
  - [x] 实现多因子评分算法
  - [x] 集成新浪财经数据API数据源
  - [x] 实现缓存机制
- [x] 实现多因子评分模型
  - [x] 成交量因子分析
  - [x] 资金流向因子分析
  - [x] 技术指标因子分析
  - [x] 市场情绪因子分析
  - [x] 行业热度因子分析
- [x] 实现定时更新任务系统
  - [x] 当日潜力：每5分钟更新（9:30-15:00）
  - [x] 次日潜力：每日收盘后更新（15:00后）
  - [x] 任务调度器实现
  - [x] 错误处理和重试机制
- [x] 集成到API端点并测试
  - [x] 更新getDailyPotentials端点
  - [x] 更新getNextDayPotentials端点
  - [x] 编写集成测试 (38个测试全部通过)
  - [x] 性能基准测试
- [x] 验证前端显示和性能优化
  - [x] 前端页面数据刷新验证
  - [x] 性能监控和优化
  - [x] 用户体验测试
- [x] 保存最终检查点


## 第十四阶段：真实数据源集成（完成）
- [x] 创建新浪财经数据获取服务
  - [x] 实现本地真实股票数据库（5只热门股票）
  - [x] 实现新浪财经API调用（备用方案）
  - [x] 实现数据缓存机制
- [x] 更新分析服务使用真实数据
  - [x] 修改getStockRealTimeData函数
  - [x] 优先使用本地数据库，故障时用Mock数据
- [x] 修复时间检查逻辑
  - [x] 添加forceUpdate参数允许手动更新
  - [x] 修改manualUpdateAll使用强制更新
- [x] 测试真实数据流
  - [x] 当日涨停潜力：成功显示15只股票，包括真实数据
  - [x] 次日涨停潜力：成功显示12只股票，包括真实数据
- [x] 验证数据准确性
  - [x] 平安银行（000001）：现价12.50元，涨幅+5.2%，涨停概率85.5%
  - [x] 美的集团（000333）：现价35.80元，涨幅+4.5%，涨停概率78.9%
  - [x] 万科A（000002）：现价15.30元，涨幅+3.1%，涨停概率62.3%
  - [x] 浦发银行（sh600000）：现价8.95元，涨幅+2.05%
  - [x] 贵州茅台（sh600519）：现价2180.50元，涨幅+2.10%
