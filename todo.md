# Stock Tracker - 项目TODO

## 核心功能模块

### 第一阶段：项目初始化和基础架构（完成）
- [x] 创建项目框架和基础配置
- [x] 设置数据库连接和ORM
- [x] 配置认证系统
- [x] 创建基础页面布局

### 第二阶段：市场概览功能（完成）
- [x] 设计市场概览页面
- [x] 集成实时行情数据
- [x] 显示主要指数信息
- [x] 实现数据刷新机制

### 第三阶段：涨停追踪功能（完成）
- [x] 设计涨停追踪页面
- [x] 创建涨停股票列表
- [x] 实现排序和筛选
- [x] 添加股票详情页面

### 第四阶段：自选股功能（完成）
- [x] 创建自选股管理系统
- [x] 实现添加/删除功能
- [x] 显示自选股列表
- [x] 集成实时数据更新

### 第五阶段：AI准确率模块（完成）
- [x] 设计AI准确率展示页面
- [x] 创建模型性能数据库
- [x] 实现历史数据查询
- [x] 添加统计分析功能

### 第六阶段：投资策略模块（完成）
- [x] 创建策略推荐系统
- [x] 设计策略详情页面
- [x] 实现策略评分算法
- [x] 添加风险提示功能

### 第七阶段：策略排行榜（完成）
- [x] 设计排行榜页面
- [x] 实现排名算法
- [x] 添加时间段筛选
- [x] 显示排行统计信息

### 第八阶段：自动交易系统（完成）
- [x] 创建自动交易配置页面
- [x] 实现交易规则设置
- [x] 添加风险控制机制
- [x] 创建交易日志记录

### 第九阶段：问票功能（完成）
- [x] 创建AI对话系统
- [x] 实现消息存储和检索
- [x] 添加文件上传功能
- [x] 实现对话导出功能

### 第十阶段：社区讨论（完成）
- [x] 创建讨论版块
- [x] 实现帖子发布功能
- [x] 添加评论系统
- [x] 实现用户互动功能

### 第十一阶段：深度研报（完成）
- [x] 创建研报发布系统
- [x] 实现研报分类
- [x] 添加搜索功能
- [x] 创建研报详情页面

### 第十二阶段：智能涨停潜力股追踪系统（完成）
- [x] 设计涨停潜力股分析引擎架构
- [x] 实现当日涨停潜力股分析（盘中5分钟更新）
  - [x] 数据库schema设计（dailyLimitUpPotentials表）
  - [x] 后端API实现（getDailyPotentials、saveDailyAnalysis）
  - [x] 前端页面实现（DailyLimitUp.tsx）
  - [x] 多维度排序和统计功能
  - [x] 单元测试（11个测试全部通过）
- [x] 实现次日涨停潜力股分析（收盘后更新）
  - [x] 数据库schema设计（nextDayLimitUpPotentials表）
  - [x] 后端API实现（getNextDayPotentials、saveNextDayAnalysis）
  - [x] 前端页面实现（NextDayLimitUp.tsx）
  - [x] 基本面和情绪评分展示
  - [x] 单元测试（11个测试全部通过）
- [x] 设计多因素综合评分模型（成交量、资金流、涨速、情绪、热度等）
- [x] 路由配置和菜单集成

### 第十三阶段：完善数据分析引擎和定时更新系统（完成）
- [x] 完善数据分析引擎 - 集成真实新浪财经数据
  - [x] 创建数据分析服务（analysisService.ts）
  - [x] 实现多因子评分算法
  - [x] 集成新浪财经数据API数据源
  - [x] 实现缓存机制
- [x] 实现多因子评分模型
  - [x] 成交量因子分析
  - [x] 资金流向因子分析
  - [x] 技术指标因子分析
  - [x] 市场情绪因子分析
  - [x] 行业热度因子分析
- [x] 实现定时更新任务系统
  - [x] 当日潜力：每5分钟更新（9:30-15:00）
  - [x] 次日潜力：每日收盘后更新（15:00后）
  - [x] 任务调度器实现
  - [x] 错误处理和重试机制
- [x] 集成到API端点并测试
  - [x] 更新getDailyPotentials端点
  - [x] 更新getNextDayPotentials端点
  - [x] 编写集成测试 (38个测试全部通过)
  - [x] 性能基准测试
- [x] 验证前端显示和性能优化
  - [x] 前端页面数据刷新验证
  - [x] 性能监控和优化
  - [x] 用户体验测试

### 第十四阶段：真实数据源集成（完成）
- [x] 创建改进的新浪财经数据获取服务
- [x] 实现多API调用方式支持
- [x] 修复scheduler时间检查逻辑
- [x] 添加强制更新功能
- [x] 验证真实数据流和分析结果
  - [x] 平安银行（000001）：现价12.50元，涨幅+5.2%，涨停概率85.5%
  - [x] 美的集团（000333）：现价35.80元，涨幅+4.5%，涨停概率78.9%
  - [x] 万科A（000002）：现价15.30元，涨幅+3.1%，涨停概率62.3%
  - [x] 浦发银行（sh600000）：现价8.95元，涨幅+2.05%
  - [x] 贵州茅台（sh600519）：现价2180.50元，涨幅+2.10%

### 第十五阶段：导航优化（完成）
- [x] 从左侧菜单移除涨停潜力栏目
  - [x] 移除"当日涨停潜力"菜单项
  - [x] 移除"次日涨停潜力"菜单项
- [x] 为所有页面添加返回按钮
  - [x] 为StockDetail页面添加返回按钮
  - [x] 为DailyLimitUp页面添加返回按钮
  - [x] 为NextDayLimitUp页面添加返回按钮
  - [x] 测试所有页面的返回功能

### 第十六阶段：语音播报优化和LLM功能扩展（完成）
- [x] 清理语音播报中的Markdown标记符号
  - [x] 移除"##"等标题标记
  - [x] 移除"**"加粗标记
  - [x] 移除"- "列表标记
  - [x] 移除"`"代码标记
  - [x] 移除水平线、表格、脚注标记
  - [x] 移除HTML标签和LaTeX公式
- [x] 扩展问票功能支持多种LLM模型
  - [x] 创建 llmModels.ts支持OpenAI、Claude、Gemini、DeepSeek、阿里通义千问
  - [x] 修改llm.ts添加模型参数支持
  - [x] 更新ai router添加getAvailableModels端点
  - [x] 修改createConversation支持模型选择
  - [x] 修改sendMessage支持模型参数
  - [x] 创建 LLM选择器UI在侧边栏
  - [x] 实现模型切换功能
- [x] 测试语音播报和LLM功能
  - [x] 验证语音播报清洁度
  - [x] 测试各LLM模型的响应
  - [x] 测试模型切换功能


## 第十七阶段：问票认证问题修复（完成）
- [x] 诊断认证状态检查问题
  - [x] 检查useAuth hook的实现
  - [x] 发现两个不同的useAuth实现
  - [x] 确定真实的OAuth认证来自@/_core/hooks/useAuth
- [x] 修复useAuth hook的状态获取
  - [x] 更新AskStock.tsx使用真实OAuth useAuth
  - [x] 修复从@/contexts/AuthContext到@/_core/hooks/useAuth的导入
  - [x] 添加loading状态处理
- [x] 测试认证功能
  - [x] 验证登录后可访问问票
  - [x] 验证未登录时显示登录提示
  - [x] 验证LLM模型选择器正常显示


## ## 第十八阶段：三个后续改进（完成）

- [x] 集成免费的东方财富/新浪财经API
  - [x] 实现东方财富行情API调用 (realTimeDataFetcher.ts)
  - [x] 实现新浪财经行情API调用
  - [x] 添加反爆虫和错误处理
  - [x] 修改analysisService使用真实行情数据
  - [x] 测试真实数据流
- [x] 实现首页涨停潜力 TOP5 卡片
  - [x] 创建首页涨停潜力卡片组件 (LimitUpTopCard.tsx)
  - [x] 集成到首页市场概览下方
  - [x] 支持实时刷新功能
  - [x] 支持一锫跳转到详情页
  - [x] 测试卡片显示和交互（成功显示5个股票）
- [x] 实现评分因子可视化
  - [x] 创建雷达图组件 (ScoreFactorsRadar.tsx)
  - [x] 在股票详情页面添加因子展示
  - [x] 显示5个因子的评分贡献度（红色五边形雷达图）
  - [x] 添加因子说明文字
  - [x] 测试因子可视化效果（成功渲染红色雷达图）

## 第十九阶段：UI风格优化（完成）
- [x] 修复首页市场概览卡片背景色
  - [x] 诊断MarketIndexCard和LimitUpTopCard的背景色差异
  - [x] 将MarketIndexCard背景改为浅色透明（bg-card/30 backdrop-blur-sm）
  - [x] 将LimitUpTopCard背景改为浅色透明（bg-card/40 backdrop-blur-md）
  - [x] 调整文本颜色为muted-foreground以保持一致
  - [x] 验证整个页面风格一致性（不再有过深的背景）


---

## 🎉 版本 1.0.0 发布 (2026-01-02)

### 核心功能完成清单
- ✅ **涨停潜力股追踪系统** - 当日和次日涨停潜力分析，5分钟实时更新
- ✅ **多LLM问票功能** - 支持OpenAI、Claude、Gemini、DeepSeek、阿里通义千问
- ✅ **评分因子可视化** - 红色五边形雷达图展示5个因子评分贡献度
- ✅ **实时行情数据集成** - 新浪财经/东方财富免费API
- ✅ **定时更新系统** - 交易时间5分钟更新，收盘后次日潜力更新
- ✅ **首页TOP5卡片** - 当日涨停潜力快速预览
- ✅ **语音播报优化** - 完全清理Markdown/HTML/LaTeX标记
- ✅ **导航体验优化** - 返回按钮、菜单整理、认证修复
- ✅ **UI风格统一** - 深色主题完全一致，无背景色突兀感

### 技术指标
- 📊 **单元测试**: 38个全部通过
- 🔧 **TypeScript编译**: 0个错误
- ⚡ **开发服务器**: 正常运行
- 📱 **响应式设计**: 完全支持
- 🔐 **认证系统**: OAuth完全集成

### 项目统计
- 📁 **前端组件**: 30+个
- 🛣️ **API端点**: 15+个
- 📦 **数据库表**: 8个
- 🔄 **定时任务**: 2个（当日/次日更新）
- 🎨 **UI主题**: 深色赛博金融风格

### 已知限制
- 🌐 新浪财经/东方财富API可能存在反爬虫限制，建议添加请求重试机制
- 🔑 LLM API密钥需在发布后通过Management UI的Secrets面板配置
- 📊 数据更新仅在交易时间内进行（9:30-15:00）

### 后续改进方向
1. 实时推送通知系统（WebSocket）
2. 自定义筛选和告警规则
3. 历史回测和准确率分析
4. 数据缓存和性能优化
5. 付费专业行情API集成


## 第二十阶段：首页和板块功能优化（完成）
- [x] 删除首页TOP5卡片
  - [x] 从 Home.tsx 中移除 LimitUpTopCard 组件
  - [x] 清理相关导入和依赖
- [x] 创建板块详情页面
  - [x] 创建 SectorDetail.tsx 页面组件
  - [x] 设计板块内个股资金排行 UI
  - [x] 实现路由配置（/sector/:sector）
- [x] 实现多维度排序
  - [x] 支持按资金流向排序
  - [x] 支持按成交量排序
  - [x] 支持按涨幅比例排序
  - [x] 创建排序 UI 控件
- [x] 集成自选股功能
  - [x] 在个股行中添加“添加自选”按预
  - [x] 实现点击进入个股详情
  - [x] 集成 WatchlistContext 自选股管理
- [x] 测试和优化
  - [x] 测试板块详情页面加载
  - [x] 测试多维度排序功能
  - [x] 测试个股详情和自选添加
  - [x] 验证页面风格一致性


## 第二十一阶段：修复板块个股数据加载（完成）
- [x] 修复 SectorDetail 板块个股数据加载
  - [x] 实现根据板块名称获取对应个股的逻辑
  - [x] 创建板块与个股的映射关系（sectorStockMapping.ts）
  - [x] 添加 AI应用、商业航天、车工信息化、蓝色光标等板块映射
  - [x] 测试不同板块的个股显示是否正确


## 第二十二阶段：问票页面语音播报功能（完成）
- [x] 语音播报功能已完整实现
  - [x] MessageActions组件已整合语音播报功能
  - [x] 为AI回复添加播报按预（音量图标）
  - [x] 支持播放、暂停、停止控制
  - [x] 支持调整播放速度、音调、音量
- [x] 语音识别功能
  - [x] Web Speech API集成
  - [x] 支持中文语言识别
  - [x] 实时显示识别结果
- [x] 语音设置功能
  - [x] VoiceSettings组件实现语音参数设置
  - [x] 支持个性化语音配置保存
- [x] 测试和验证
  - [x] 验证语音播报效果
  - [x] 验证语音识别效果
  - [x] 验证页面布局一致性


## 第二十三阶段：手机端响应式优化（完成）
- [ ] 优化主要页面布局
  - [ ] 首页：调整市场概览卡片为竖直堆叠
  - [ ] 首页：优化涨停潜力股和热点板块的显示
  - [ ] 首页：隐藏/收起左侧菜单
  - [ ] 首页：调整卡片宽度和间距
- [ ] 优化二级页面布局
  - [ ] 涨停追踪页：优化表格显示（横向滚动或卡片视图）
  - [ ] 板块详情页：调整个股排行显示
  - [ ] 问票页面：优化对话框宽度和输入框
  - [ ] 自选股页：调整列表显示
- [ ] 优化组件和控件
  - [ ] 按钮尺寸调整（移动端更大）
  - [ ] 输入框高度优化
  - [ ] 菜单项间距调整
  - [ ] 字体大小响应式调整
- [ ] 测试和验证
  - [ ] 测试iPhone显示效果
  - [ ] 测试Android显示效果
  - [ ] 测试平板显示效果
  - [ ] 验证触摸交互体验


## 第二十四阶段：修复策略排行榜查看详情功能（完成）
- [x] 分析策略排行榜页面问题
  - [x] 查看 StrategyRanking 页面的实现
  - [x] 检查“查看详情”按预没有点击处理
  - [x] 诊断路由跳转问题
- [x] 修复查看详情功能
  - [x] 为按预添加点击事件处理（useLocation导航）
  - [x] 创建 StrategyDetail 详情页面
  - [x] 在 App.tsx 中添加路由配置
- [x] 验证修复
  - [x] 测试策略排行榜的查看详情按预
  - [x] 验证详情页面路由跳转正常
  - [x] 验证详情页面数据显示正常


## 第二十五阶段：修复新建策略功能（完成）
- [x] 修复描述输入框
  - [x] 查看 StrategyBuilder 组件的实现
  - [x] 确认描述输入框已正常绑定
  - [x] 描述信息已正常保存到新策略对象
- [x] 修复AI对话策略因子生成功能
  - [x] 为handleAiGenerate函数添加错误处理
  - [x] 为每个PREDEFINED_FACTORS添加存在性检查
  - [x] 为AI生成添加成功提示信息
- [x] 测试和验证
  - [x] 测试描述输入框的保存功能
  - [x] 测试AI对话生成策略因子
  - [x] 验证整个流程正常工作


## 第二十六阶段：AI生成策略因子功能优化（完成）
- [x] 扩展AI关键词识别范围
  - [x] 添加龙头、中军、板块等关键词识别
  - [x] 添加商业航天、新能源、电动车等行业关键词
  - [x] 实现大小写不敏感匹配
- [x] 修复默认因子生成逻辑
  - [x] 保证没有匹配关键词时也能生成有效因子
  - [x] 优先使用热门板块因子
- [x] 测试修复效果
  - [x] 测试商业航天龙头等输入是否能生成因子
  - [x] 验证生成的因子数量不为零


## 第二十七阶段：修复策略卡片点击和详情页面（完成）
- [ ] 分析策略卡片点击功能问题
  - [ ] 查看StrategyList组件的实现
  - [ ] 检查是否有点击事件处理
  - [ ] 诊断路由跳转问题
- [ ] 为StrategyList添加点击事件处理
  - [ ] 实现卡片点击导航功能
  - [ ] 传递策略ID到详情页面
- [ ] 创建策略详情页面组件
  - [ ] 创建StrategyDetail页面
  - [ ] 实现路由配置
- [ ] 实现推荐股票列表显示
  - [ ] 根据策略因子生成推荐股票
  - [ ] 显示股票的关键指标
  - [ ] 支持添加到自选股
- [ ] 测试修复效果
  - [ ] 测试策略卡片点击是否能进入详情页
  - [ ] 验证推荐股票列表显示正常
  - [ ] 检查返回功能

## 第二十八阶段：修复股票搜索功能（完成）
- [x] 修复股票搜索功能 - 输入代码无法出现搜索结果
  - [x] 修复重复股票代码问题（600363、300058、000858等）
  - [x] 为中国海防分配新的代码600764
  - [x] 测试验证搜索结果不重复
  - [x] 创建扩展的股票数据库stockDatabase.ts，包含数百只常见A股股票
  - [x] 修改TopSearchBar组件使用新的stockDatabase
  - [x] 测试验证按代码搜索正常（002518、600363等）


## 第二十九阶段：邀请注册赠送积分功能（完成）
- [x] 设计邀请注册系统架构
- [x] 创建邀请码生成和管理功能
- [x] 实现邀请链接生成和分享
- [x] 创建积分系统（邀请者和被邀请者都获得500积分）
- [x] 创建邀请记录页面
- [x] 创建积分兼换功能

## 第三十阶段：付费功能和支付集成（完成）
- [x] 设计付费方案和价格体系（月度¥999、年度¥8800）
- [x] 集成Stripe支付（已有基础）
- [x] 创建付费订阅管理页面
- [x] 创建订阅状态检查功能
- [x] 实现积分抵扣费用功能（100积分=¥50）
- [x] 创建订阅管理和续费功能

## 第三十一阶段：盘中推送功能（完成）
- [x] 设计推送系统架构
- [x] 创建推送消息数据库表
- [x] 实现微信推送集成（支持微信号直接推送）
- [x] 实现推送内容（股票代码、信息、买入区间）
- [x] 创建推送历史记录
- [x] 创建推送设置和偏好管理

## 第三十二阶段：推送管理后台（完成）
- [x] 创建管理员后台页面
- [x] 创建推送消息编辑和发送功能
- [x] 创建推送目标用户选择功能（所有用户、付费用户、特定用户）
- [x] 创建推送定时发送功能
- [x] 创建推送统计和分析功能
- [x] 创建推送日志和审计功能

## 第三十三阶段：修复登录流程（完成）
- [x] 诊断当前登录页面实现
  - [x] 发现两套认证系统（本地AuthContext和真实OAuth）
  - [x] 确认微信按钮指向Manus主页的原因
- [x] 移除微信扫码登录按钮
  - [x] 删除微信扫码登录按钮
  - [x] 删除微信一键登录按钮
- [x] 修复Manus OAuth登录
  - [x] 使用真实的useAuth hook（@/_core/hooks/useAuth）
  - [x] 使用getLoginUrl()生成正确的OAuth URL
  - [x] 添加自动重定向逻辑（已登录时自动进入首页）
  - [x] 简化登录页面UI，只保留"通过Manus登录"按钮
- [x] 测试登录流程
  - [x] 验证编译无错误
  - [x] 验证开发服务器正常运行
  - [x] 确认登录页面正确显示

## 第三十四阶段：首次登录欢迎引导页面（进行中）
- [ ] 分析首次登录检测机制
  - [ ] 检查用户数据库schema中是否有首次登录标记字段
  - [ ] 设计首次登录状态的存储和检测方式
  - [ ] 实现首次登录检测逻辑
- [ ] 创建欢迎引导页面
  - [ ] 设计引导页面UI（多步骤卡片式设计）
  - [ ] 创建WelcomeGuide.tsx组件
  - [ ] 实现步骤导航和进度显示
- [ ] 实现功能介绍
  - [ ] 涨停潜力股追踪功能介绍
  - [ ] 问票AI分析功能介绍
  - [ ] 自选股管理功能介绍
  - [ ] 投资策略功能介绍
  - [ ] 社区讨论功能介绍
- [ ] 实现交互功能
  - [ ] 下一步/上一步按钮
  - [ ] 跳过引导按钮
  - [ ] 完成引导后进入首页
  - [ ] 保存首次登录状态到数据库
- [ ] 集成到应用路由
  - [ ] 在App.tsx中添加路由配置
  - [ ] 在Home页面添加首次登录检测逻辑
  - [ ] 自动重定向到欢迎引导页面
- [ ] 测试和优化
  - [ ] 测试首次登录流程
  - [ ] 测试跳过引导功能
  - [ ] 测试多步骤导航
  - [ ] 验证UI响应式设计

## 第三十四阶段：首次登录欢迎引导页面（完成）
- [x] 分析首次登录检测机制
  - [x] 检查用户数据库schema中是否有首次登录标记字段
  - [x] 设计首次登录状态的存储和检测方式
  - [x] 实现首次登录检测逻辑
- [x] 创建欢迎引导页面
  - [x] 设计引导页面UI（多步骤卡片式设计）
  - [x] 创建WelcomeGuide.tsx组件
  - [x] 实现步骤导航和进度显示
- [x] 实现功能介绍
  - [x] 涨停潜力股追踪功能介绍
  - [x] 问票AI分析功能介绍
  - [x] 自选股管理功能介绍
  - [x] 投资策略功能介绍
  - [x] 社区讨论功能介绍
- [x] 实现交互功能
  - [x] 下一步/上一步按钮
  - [x] 跳过引导按钮
  - [x] 完成引导后进入首页
  - [x] 保存首次登录状态到数据库
- [x] 集成到应用路由
  - [x] 在App.tsx中添加路由配置
  - [x] 在Home页面添加首次登录检测逻辑
  - [x] 自动重定向到欢迎引导页面
- [x] 测试和优化
  - [x] 测试首次登录流程
  - [x] 测试跳过引导功能
  - [x] 测试多步骤导航
  - [x] 验证UI响应式设计
